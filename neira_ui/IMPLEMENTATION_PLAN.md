# Web Components Rewrite Implementation Plan

## Overview
Rewrite the Svelte UI (`neira_ui_svelte/`) as vanilla web components without a build step in `neira_ui/`.

## Goals
- No build step required
- Use modern web standards (Web Components, ES modules)
- Maintain feature parity with Svelte version
- Simple deployment (just copy static files)

## Proposed Directory Structure

```
neira_ui/
├── index.html                 # Home page
├── ranking.html              # Ranking page (handles ?slug= param)
├── seeding-tool.html         # Seeding tool page
├── js/
│   ├── components/
│   │   ├── page-layout.js           # Layout wrapper component
│   │   ├── modal-dialog.js          # Modal component
│   │   └── reorderable-list.js      # Drag-and-drop table component
│   ├── utils/
│   │   ├── router.js                # Simple hash/query-based router
│   │   ├── state.js                 # Reactive state management
│   │   ├── csv-parser.js            # CSV parsing utility
│   │   └── path-finding.js          # Port of pathlength.js
│   └── pages/
│       ├── home.js                  # Home page logic
│       ├── ranking.js               # Ranking page logic
│       └── seeding-tool.js          # Seeding tool logic
├── css/
│   └── styles.css                   # Custom styles (w3.css loaded from CDN)
└── static/                          # Symlink to neira_ui_svelte/static
    ├── dot/                         # Generated by Python backend
    └── tables/                      # Generated by Python backend
```

## Phase 1: Foundation (Start Here)

### 1.1 Basic Setup
- [x] Create `neira_ui/` directory
- [ ] Create directory structure as above
- [ ] Create symlink: `neira_ui/static -> neira_ui_svelte/static`
- [ ] Set up base HTML template with w3.css

### 1.2 Shared Utilities

#### `js/utils/csv-parser.js`
Port from `neira_ui_svelte/src/routes/ranking/fours/girls/[slug]/csv.js`
```javascript
export function parseCSV(text) {
  // Parse CSV text into 2D array
  // Handle quoted fields properly
}
```

#### `js/utils/state.js`
Simple reactive state management:
```javascript
export class State {
  constructor(initialState) { /* ... */ }
  subscribe(callback) { /* ... */ }
  update(updater) { /* ... */ }
  get() { /* ... */ }
}
```

#### `js/utils/router.js`
Simple routing based on query params:
```javascript
export const router = {
  getParam(name) { /* ... */ },
  setParam(name, value) { /* ... */ },
  navigate(url) { /* ... */ }
};
```

#### `js/utils/path-finding.js`
Port from `neira_ui_svelte/src/routes/seeding-tool/pathlength.js`

## Phase 2: Simple Components

### 2.1 Page Layout Component
**File:** `js/components/page-layout.js`

**Features:**
- Top navigation bar
- Slot for page content
- W3.CSS styling

**Complexity:** LOW
**Estimated Time:** 1-2 hours

**Implementation approach:**
```javascript
class PageLayout extends HTMLElement {
  connectedCallback() {
    this.innerHTML = `
      <div class="w3-bar w3-top w3-black w3-large">
        <span class="w3-bar-item w3-right">neira</span>
      </div>
      <div class="w3-main" style="margin-left:30px;margin-top:43px;">
        <slot></slot>
      </div>
    `;
  }
}
customElements.define('page-layout', PageLayout);
```

### 2.2 Modal Dialog Component
**File:** `js/components/modal-dialog.js`

**Features:**
- Show/hide with `showModal` property
- Slots for header and body
- Apply/close buttons
- Backdrop click to close

**Complexity:** LOW-MEDIUM
**Estimated Time:** 2-3 hours

**Implementation approach:**
- Use native `<dialog>` element
- Custom events for apply/close actions
- CSS animations for zoom effect

## Phase 3: Home Page

**File:** `index.html`

**Features:**
- Static links to dot files and tables
- About section
- Link to seeding tool

**Complexity:** LOW
**Estimated Time:** 1 hour

**Implementation approach:**
- Mostly static HTML
- Use template literals for base path if needed
- No complex JS required

## Phase 4: Ranking Page

### 4.1 Reorderable List Component
**File:** `js/components/reorderable-list.js`

**Features:**
- Drag-and-drop table rows
- Touch support for mobile
- Visual feedback during drag
- Maintains row order state

**Complexity:** MEDIUM-HIGH
**Estimated Time:** 4-6 hours

**Challenges:**
- Drag-and-drop API (both mouse and touch)
- Visual feedback without Svelte transitions
- State synchronization

**Implementation approach:**
- Use HTML5 Drag and Drop API
- Touch events for mobile
- CSS transitions for visual feedback
- Emit custom events when order changes

### 4.2 Ranking Page Logic
**File:** `ranking.html` + `js/pages/ranking.js`

**Features:**
- Load CSV based on URL param (?slug=1, ?slug=2, etc.)
- Parse and display in reorderable table
- Build margins lookup object

**Complexity:** MEDIUM
**Estimated Time:** 2-3 hours

**Implementation approach:**
```javascript
// js/pages/ranking.js
import { parseCSV } from '../utils/csv-parser.js';
import { router } from '../utils/router.js';

async function initRankingPage() {
  const slug = router.getParam('slug') || '1';
  const res = await fetch(`/static/dot/girls${slug}fours.csv`);
  const csv = await res.text();
  const table = parseCSV(csv);

  // Build margins object
  // Render with reorderable-list component
}
```

## Phase 5: Seeding Tool (Most Complex)

**File:** `seeding-tool.html` + `js/pages/seeding-tool.js`

**Features:**
- Two-column layout (unseeded vs seeded)
- Keyboard navigation (arrow keys)
- Multi-selection (shift-click)
- LocalStorage persistence
- Move items between lists
- Modal for copy/paste seeding
- Display race data for selected schools
- Path-finding for comparisons

**Complexity:** HIGH
**Estimated Time:** 8-12 hours

**Challenges:**
- Complex state management (3 state objects)
- Keyboard event handling
- Selection logic (single + multi-select)
- Drag animations (replacing Svelte crossfade/flip)
- Data loading and transformation
- LocalStorage sync

### 5.1 State Structure
```javascript
const seedingState = new State({
  unseeded: [],    // Array of school objects {id, description}
  seeding: [],     // Array of school objects {id, description}
  selected: [],    // Array of 1-2 selected schools
  tuples: [],      // Array of race results
  showModal: false,
  textareaContents: ''
});
```

### 5.2 Implementation Approach

**Option A: Single Page with Manual Rendering**
- Use `State` class to manage state
- Manual DOM updates on state changes
- Event listeners for all interactions

**Option B: Web Components for List Items**
- `<school-list>` component for each list
- `<school-item>` component for items
- Properties flow down, events bubble up

**Recommendation:** Option A (simpler, fewer abstractions)

### 5.3 Animation Strategy

Replace Svelte's `crossfade` and `flip`:
- Use CSS transitions for simple animations
- Optional: Use Web Animations API for more complex effects
- Or: Skip animations entirely (acceptable for v1)

### 5.4 Key Functions to Implement

```javascript
// Movement between lists
function moveToSeeding(school) { }
function moveToUnseeded(school) { }

// Reordering within lists
function moveUp(list, index) { }
function moveDown(list, index) { }

// Selection
function handleItemClick(school, event) { }

// Keyboard navigation
function handleKeyDown(event) { }

// LocalStorage
function saveState() { }
function loadState() { }

// Data processing
function buildTuples(races, foundersDay) { }
```

## Phase 6: Integration & Testing

### 6.1 Static File Serving
Test with simple HTTP server:
```bash
cd neira_ui
python3 -m http.server 8000
# Visit http://localhost:8000
```

### 6.2 Path Configuration
Ensure all paths work relative to:
- Development: `http://localhost:8000/`
- Production: `https://mattdailis.github.io/neira/`

Options:
- Base tag in HTML: `<base href="/neira/">`
- Or: Runtime detection of base path
- Or: Keep paths relative

### 6.3 Testing Checklist
- [ ] Home page loads and links work
- [ ] Ranking page loads CSV for different slugs
- [ ] Reorderable list drag-and-drop works (mouse)
- [ ] Reorderable list drag-and-drop works (touch)
- [ ] Seeding tool loads race data
- [ ] Seeding tool keyboard navigation works
- [ ] Seeding tool LocalStorage persistence works
- [ ] Seeding tool modal copy/paste works
- [ ] Seeding tool displays correct race comparisons
- [ ] All pages work in production (GitHub Pages)

## Phase 7: Deployment

### 7.1 Update Python Pipeline
Modify commands to output to `neira_ui/static` instead of `neira_ui_svelte/static`:

```python
# neira/main.py
neira dot data/2_reviewed neira_ui/static/dot
neira head-to-head neira_ui/static/tables
```

### 7.2 Update Deployment Script
```bash
# Instead of building Svelte
cd neira_ui
# Just copy to docs
cd ..
rm -rf docs
cp -r neira_ui docs

git commit
git push
```

### 7.3 Update Documentation
- Update `README.md` with new build process
- Update `CLAUDE.md` with new architecture
- Remove references to npm/Svelte

## Phased Rollout Strategy

### Option 1: All-at-once
- Complete entire rewrite
- Switch deployment script
- Replace `neira_ui_svelte` completely

### Option 2: Gradual (Recommended)
- Keep `neira_ui_svelte` working
- Build `neira_ui` incrementally
- Test thoroughly before switching
- Deploy to subdirectory first for testing

## Estimated Total Time

| Phase | Hours | Cumulative |
|-------|-------|------------|
| Phase 1: Foundation | 3-4h | 3-4h |
| Phase 2: Simple Components | 3-5h | 6-9h |
| Phase 3: Home Page | 1h | 7-10h |
| Phase 4: Ranking Page | 6-9h | 13-19h |
| Phase 5: Seeding Tool | 8-12h | 21-31h |
| Phase 6: Testing | 2-3h | 23-34h |
| Phase 7: Deployment | 1-2h | 24-36h |

**Total: 24-36 hours** (3-4 full working days)

## Risk Mitigation

### High Risk Items
1. **Drag-and-drop complexity** - May need library
2. **Animation quality** - May not match Svelte smoothness
3. **Browser compatibility** - Test in Safari, Firefox, Chrome
4. **Mobile touch events** - Separate testing needed

### Fallback Plans
1. If drag-and-drop too complex: Start with click-to-move buttons
2. If animations problematic: Ship without (add later)
3. If seeding tool too complex: Simplify to read-only view first

## Success Criteria

- [ ] All features from Svelte version work
- [ ] No build step required
- [ ] Works in production on GitHub Pages
- [ ] Code is maintainable (clear, documented)
- [ ] Performance is acceptable (no lag)
- [ ] Mobile experience works (touch events)

## Next Steps

1. Review this plan with you
2. Make any adjustments based on priorities
3. Start with Phase 1 (Foundation)
4. Build incrementally, testing each phase
5. Get feedback after each major component

---

## Questions to Discuss

1. **Animations**: How important are smooth animations vs. simple transitions?
2. **Browser support**: Target latest 2 versions or wider support?
3. **Mobile priority**: How important is mobile/touch experience?
4. **Feature parity**: Must have 100% feature parity or can we simplify?
5. **Timeline**: When would you like this completed?
6. **Rollout**: Prefer gradual rollout or all-at-once replacement?
